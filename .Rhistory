f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
a <- group_by(stg6, year) %>% summarise(mean(d4*f2014))
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
, fe vce(cluster id)', data.in = stg6)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# generate fq
stgyr <- 2013:2016
ans <- lapply(stgyr, function(year) as.numeric(stg6$year == year)) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
stg6 <- cbind(stg6, ans)
# generate dq
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
#
n <- stgyr[length(stgyr)] -stgyr[1] + 1
ans <- lapply(n:1, function(i) as.integer(stg6$wsum == i)) %>% bind_cols() %>% suppressMessages()
# rename
entry_yr <- stgyr - min(stg6$year) + 1
names(ans) <- paste('d', entry_yr, sep = '')
stg6 <- cbind(stg6, ans)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + f2014 + f2015 + f2016 + d4 + d5+ d6, data = stg6)
summary(ans)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2013 f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
0.97/(0.97+0.19)
0.97^2/(0.97^2+0.19^2)
group_by(stg6, year) %>% summarise(mean(d4*f2014))
?plm
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
library(skimr)
skim(stg6)
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
skim(stg6)
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
stg6[1:7,]
stg6$f2014 <- as.integer(stg6$year == 2014)
stg6$f2015 <- as.integer(stg6$year == 2015)
stg6$f2016 <- as.integer(stg6$year == 2016)
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
stg6$d4 <- as.integer(stg6$wsum == 3)
stg6$d5 <- as.integer(stg6$wsum == 2)
stg6$d6 <- as.integer(stg6$wsum == 1)
plm::plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6) %>%
summary()
library(did)
?aggte
data(mpdta)
force(mpdta)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
usethis::use_data(stg6)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# generate fq
gen_fst(stg6, 'year', 2013:2016)
source("~/elements/RawE/27_MyRPackages/didWD/data-raw/reg.R", echo=TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
# generate fq
stg6 <- gen_fst(stg6, 'year', 2013:2016)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr = 2013:2016)
View(stg6)
# 双因素回归
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
document()
document()
# ----------add X--------------
# 对X组内去均值
stg6$x1_dm4 <- stg6$x1 - mean(stg6$x1[stg6$d4==1])
stg6$x1_dm5 <- stg6$x1 - mean(stg6$x1[stg6$d5==1])
stg6$x1_dm6 <- stg6$x1 - mean(stg6$x1[stg6$d6==1])
stata('
logy c.w#c.d4#c.f2014 c.w#c.d4#c.f2015 c.w#c.d4#c.f2016 ///
c.w#c.d5#c.f2015 c.w#c.d5#c.f2016 ///
c.w#c.d6#c.f2016 ///
c.w#c.d4#c.f2014#c.x1_dm4 c.w#c.d4#c.f2015#c.x1_dm4 c.w#c.d4#c.f2016#c.x1_dm4 ///
c.w#c.d5#c.f2015#c.x1_dm5 c.w#c.d5#c.f2016#c.x1_dm5 ///
c.w#c.d6#c.f2016#c.x1_dm6 ///
f2014 f2015 f2016 c.f2014#c.x1 c.f2015#c.x1 c.f2016#c.x1, fe vce(cluster id)
')
stata('
xtset id year
xtreg logy c.w#c.d4#c.f2014 c.w#c.d4#c.f2015 c.w#c.d4#c.f2016 ///
c.w#c.d5#c.f2015 c.w#c.d5#c.f2016 ///
c.w#c.d6#c.f2016 ///
c.w#c.d4#c.f2014#c.x1_dm4 c.w#c.d4#c.f2015#c.x1_dm4 c.w#c.d4#c.f2016#c.x1_dm4 ///
c.w#c.d5#c.f2015#c.x1_dm5 c.w#c.d5#c.f2016#c.x1_dm5 ///
c.w#c.d6#c.f2016#c.x1_dm6 ///
f2014 f2015 f2016 c.f2014#c.x1 c.f2015#c.x1 c.f2016#c.x1, fe vce(cluster id)
', data.in = stg6)
plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
knitr::opts_chunk$set(echo = TRUE)
library(lmtest)
?coeftest
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2011 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
stg6$f2012 <- as.integer(stg6$year == 2012)
stg6$f2013 <- as.integer(stg6$year == 2013)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2011 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
library(car)
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
library(car)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
summary(ans)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + f2012:d5 + f2013:d5 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
ans <- plm(logy ~ f2012 + f2013 + f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
linearHypothesis(ans, CTH0)
CTH0 <- c('f2012:d4', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('f2012:d4', 'f2013:d4', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
# generate fq
stg6 <- gen_fst(stg6, 'year', 2013:2016)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr = 2013:2016)
# 双因素回归
ans <- plm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
plm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016 + d2014:f2014:x1_dm4 + d2014:f2015:x1_dm4 + d2014:f2016:x1_dm4 + d2015:f2015:x1_dm5 +
d2015:f2016:x1_dm5 + d2016:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
?coeftest
?vcovHC.plm
coeftest(ans, vcov. = vcovHC, method = 'white2')
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
coeftest(ans, vcov. = vcovHC, method = 'arellano')
coeftest(ans, vcov. = vcovHC, method = 'white2')
?vcovHC
linearHypothesis(ans, CTH0, vcov. = vcovHC)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm)
# 这是我的本地存储，你可以下载数据后更换成你的存储位置
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
stg6[1:7,]
stg6$f2014 <- as.integer(stg6$year == 2014)
stg6$f2015 <- as.integer(stg6$year == 2015)
stg6$f2016 <- as.integer(stg6$year == 2016)
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
stg6$d4 <- as.integer(stg6$wsum == 3)
stg6$d5 <- as.integer(stg6$wsum == 2)
stg6$d6 <- as.integer(stg6$wsum == 1)
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
library(lmtest)
coeftest(ans, vcov. = vcovHC, method = 'white2')
stg6$x1_dm4 <- stg6$x1 - mean(stg6$x1[stg6$d4==1])
stg6$x1_dm5 <- stg6$x1 - mean(stg6$x1[stg6$d5==1])
stg6$x1_dm6 <- stg6$x1 - mean(stg6$x1[stg6$d6==1])
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
coeftest(ans, vcov. = vcovHC, method = 'white2')
stg6$f2012 <- as.integer(stg6$year == 2012)
stg6$f2013 <- as.integer(stg6$year == 2013)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
library(car)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
CTH0 <- c('f2012:d4', 'f2013:d4', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0, vcov. = vcovHC)
linearHypothesis(ans, CTH0, vcov. = vcovHC, method = 'white2)
linearHypothesis(ans, CTH0, vcov. = vcovHC, method = 'white2')
linearHypothesis(ans, CTH0)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
# generate fq
stg6 <- gen_fst(stg6, 'year', 2013:2016)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr = 2013:2016)
# ---------无协变量估计------------
# 混合回归
ans <- lm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016 + f2014 + f2015 + f2016 + d2014 + d2015+ d2016, data = stg6)
summary(ans)
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
# 双因素回归
ans <- plm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
?summary.lm
coeftest(ans, vcov. = vcovHC, method = 'white2')
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
coeftest(ans, vcov. = vcovHC, method = 'white2')
coeftest(ans, vcov. = vcovHC, method = 'white1')
paste('d', stgyr, sep = '')
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
stgyr <- 2014:2016
# generate fq
stg6 <- gen_fst(stg6, 'year', stgyr)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr)
paste('d', stgyr, sep = '')
paste('f', stgyr, sep = '')
unique(stg6$year)
allyr <- unique(stg6$year)
allyr[allyr >= min(stgyr)]
allyr[allyr >= min(stgyr)] %>% paste('f',.,sep = '')
allyr[allyr >= min(stgyr)] %>% paste('f',.,sep = '') %>% paste(paste('d', stgyr, sep = ''), sep = ':')
calendar <- allyr[allyr >= min(stgyr)] %>% paste('f',.,sep = '')
calendar <- allyr[allyr >= min(stgyr)]
ans <- NULL
for (dyr in stgyr) {
for (fyr in calendar) {
if (dyr >= fyr){
ans <- c(ans, paste(paste('d',dyr, sep = ''), paste('f', fyr, sep = ''),sep = ':'))
}
}
}
ans
ans <- NULL
for (fyr in stgyr) {
for (dyr in calendar) {
if (dyr >= fyr){
ans <- c(ans, paste(paste('d',dyr, sep = ''), paste('f', fyr, sep = ''),sep = ':'))
}
}
}
ans
ans <- NULL
for (fyr in stgyr) {
for (dyr in calendar) {
if (fyr >= dyr){
ans <- c(ans, paste(paste('d',dyr, sep = ''), paste('f', fyr, sep = ''),sep = ':'))
}
}
}
ans
ans <- NULL
for (fyr in stgyr) {
for (dyr in calendar) {
if (fyr >= dyr){
ans <- c(ans, paste(paste('d',dyr, sep = ''), paste('f', fyr, sep = ''),sep = ':'))
}
}
}
ans
paste(ans, collapse = '+')
paste('logy', paste(ans, collapse = '+'), sep = '~')
fml <- eval(parse(text = paste('logy', paste(ans, collapse = '+'), sep = '~')))
fml
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
stgyr <- 2014:2016
# generate fq
stg6 <- gen_fst(stg6, 'year', stgyr)
# generate dq
stg6 <- gen_dq(stg6, 'id', w, stgyr)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
load_all()
stg6
stg6$year[stg6$w!=0] %>% unique()
dt <- stg6
# generate fq
dt <- gen_fst(dt, 'year', stgyr)
stgyr <- dt$year[dt$w!=0] %>% unique()
# generate fq
dt <- gen_fst(dt, 'year', stgyr)
# generate dq
dt <- gen_dq(dt, 'id', w, stgyr)
View(dt)
# generate formula
allyr <- unique(dt[,year])
calendar <- allyr[allyr >= min(stgyr)]
id = 'id'
year = 'year'
w = 'w'
y = 'logy'
# generate formula
allyr <- unique(dt[,year])
calendar <- allyr[allyr >= min(stgyr)]
ans <- NULL
for (fyr in stgyr) {
for (dyr in calendar) {
if (fyr >= dyr){
ans <- c(ans, paste(paste('d',dyr, sep = ''), paste('f', fyr, sep = ''),sep = ':'))
}
}
}
fml <- eval(parse(text = paste(y, paste(ans, collapse = '+'), sep = '~')))
fit <- plm(fml, index = c(id,year), effect = 'twoways',model = 'within', data = dt)
summary(fit)
View(fit)
fit[["vcov"]]
coeftest(fit, vcov. = vcovHC, method = 'white2')
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
load_all()
didWD(stg6, 'id', 'year', 'logy', 'w')
didWD(stg6, 'id', 'year', 'logy', 'w') %>% summary()
# 双因素回归
fit <- didWD(stg6, id = 'id', year = 'year', y = 'logy', w = 'w')
coeftest(fit, vcov. = vcovHC, method = 'white2')
# ---------无协变量估计------------
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
dt <- gen_fst(stg6, year, stgyr) %>% gen_dq(id, w, stgyr)
# ---------无协变量估计------------
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = dt)
stgyr <- 2014:2016
dt <- gen_fst(stg6, 'year', stgyr) %>% gen_dq('id', 'w', stgyr)
# ---------无协变量估计------------
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = dt)
# 双因素回归
fit <- didWD(stg6, id = 'id', year = 'year', y = 'logy', w = 'w')
coeftest(fit, vcov. = vcovHC, method = 'white2')
document()
document()
check()
use_package('plm')
use_package('tidyverse')
data(stg6, package = 'didWD')
tidyverse::`%>%`
check()
use_package('magrittr')
check()
?magrittr::`.`
check()
use_package('dplyr')
document()
check()
?use_package
use_package('lmtest', type = 'Suggests')
?FAVAR::FAVAR
use_gpl3_license()
check()
car::vcovHC
document()
document()
check()
View(stg6)
check()
library(magrittr)
?`%>%`
check()
document()
check()
use_readme_rmd()
document()
check()
check()
check()
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools, lmtest)
load_all()
fit <- didWD(stg6, id = 'id', year = 'year', y = 'logy', w = 'w')
lmtest::coeftest(fit, vcov. = vcovHC, method = 'white2')
library(plm)
lmtest::coeftest(fit, vcov. = vcovHC, method = 'white2')
lmtest::coeftest(fit$fit, vcov. = vcovHC, method = 'white2')
check()

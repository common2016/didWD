library(devtools)
use_data_raw('reg')
library(pacman)
p_load(readstata13)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
View(stg6)
# generate fq, dq
stg6$f2014 <- stg6$year == 2014
p_load(readstata13, tidyverse)
# generate fq, dq
lapply(2014:2016, function(year) stg6$year == year) %>% bind_cols()
# generate fq, dq
lapply(2014:2016, function(year) stg6$year == year) %>% bind_cols() %>% suppressMessages()
# generate fq, dq
ans <- lapply(2014:2016, function(year) stg6$year == year) %>% bind_cols() %>%
cbind(stg6,.)
# generate fq, dq
ans <- lapply(2014:2016, function(year) stg6$year == year) %>% bind_cols() %>%
cbind(stg6,.) %>% suppressMessages()
View(ans)
# generate fq, dq
ans <- lapply(2014:2016, function(year) stg6$year == year) %>% bind_cols()
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# generate fq, dq
stgyr <- 2014:2016
ans <- lapply(stgyr, function(year) stg6$year == year) %>% bind_cols()
ans <- lapply(stgyr, function(year) stg6$year == year) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
ans <- lapply(stgyr, function(year) as.numeric(stg6$year == year)) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
stg6 <- cbind(stg6, ans)
group_by(stgyr, id) %>% summarise(id = id, wsum = sum(w))
group_by(stgyr, id) %>% summarise(wsum = sum(w))
stg6$id <- as.factor(stg6$id)
group_by(stgyr, id) %>% summarise(wsum = sum(w))
?group_by
group_by(stg6, id) %>% summarise(wsum = sum(w))
source("~/elements/RawE/27_MyRPackages/didWD/data-raw/reg.R", echo=TRUE)
# stg6$id <- as.factor(stg6$id)
group_by(stg6, id) %>% summarise(id = id, wsum = sum(w)) %>% left_join(stg6,., by = 'id')
# stg6$id <- as.factor(stg6$id)
stg6 <- group_by(stg6, id) %>% summarise(id = id, wsum = sum(w)) %>% left_join(stg6,., by = 'id')
source("~/elements/RawE/27_MyRPackages/didWD/data-raw/reg.R", echo=TRUE)
?summarise
group_by(stg6, id) %>% summarise( wsum = sum(w), .groups = 'keep')
group_by(stg6, id) %>% summarise( wsum = sum(w), .groups = 'rowwise')
View(stg6)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# generate fq, dq
stgyr <- 2014:2016
ans <- lapply(stgyr, function(year) as.numeric(stg6$year == year)) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
stg6 <- cbind(stg6, ans)
group_by(stg6, id) %>% summarise(wsum = sum(w))
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
n <- stgyr[length(stgyr)] -stgyr[1]
n <- stgyr[length(stgyr)] -stgyr[1] + 1
lapply(1:n, function(i) stg6$wsum == i) %>% bind_cols()
ans <- lapply(1:n, function(i) stg6$wsum == i) %>% bind_cols()
View(ans)
ans <- lapply(1:n, function(i) as.integer(stg6$wsum == i)) %>% bind_cols()
ans <- lapply(n:1, function(i) as.integer(stg6$wsum == i)) %>% bind_cols() %>% suppressMessages()
stgyr[1] - min(stg6$year)
entry_yr <- stgyr[1] - min(stg6$year) + 1
stgyr - min(stg6$year) + 1
names(ans) <- paste('d', entry_yr, sep = '')
paste('d', entry_yr, sep = '')
entry_yr <- stgyr - min(stg6$year) + 1
paste('d', entry_yr, sep = '')
names(ans) <- paste('d', entry_yr, sep = '')
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# generate fq
stgyr <- 2014:2016
ans <- lapply(stgyr, function(year) as.numeric(stg6$year == year)) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
stg6 <- cbind(stg6, ans)
# generate dq
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
#
n <- stgyr[length(stgyr)] -stgyr[1] + 1
ans <- lapply(n:1, function(i) as.integer(stg6$wsum == i)) %>% bind_cols() %>% suppressMessages()
# rename
entry_yr <- stgyr - min(stg6$year) + 1
names(ans) <- paste('d', entry_yr, sep = '')
stg6 <- cbind(stg6, ans)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2014 + d5:f2015 + d5:f2016 +
d6:f2014 + d6:f2015 + d6:f2016 + f2014 + f2015 + f2016, data = stg6)
summary(ans)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2014 + d5:f2015 + d5:f2016 +
d6:f2014 + d6:f2015 + d6:f2016 + f2014 + f2015 + f2016 + d4 + d5+ d6, data = stg6)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2014 + d5:f2015 + d5:f2016 +
d6:f2014 + d6:f2015 + d6:f2016 + f2014 + f2015 + f2016 + d4 + d5+ d6, data = stg6)
summary(ans)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + f2014 + f2015 + f2016 + d4 + d5+ d6, data = stg6)
summary(ans)
a <- group_by(stg6, year) %>% summarise(mean(d4*f2014))
View(a)
a <- group_by(stg6, id) %>% summarise(mean(d4*f2014))
p_load(readstata13, tidyverse, plm)
p_load(readstata13, tidyverse, plm, RStata)
stata('xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
a <- group_by(stg6, year) %>% summarise(mean(d4*f2014))
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
, fe vce(cluster id)', data.in = stg6)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# generate fq
stgyr <- 2013:2016
ans <- lapply(stgyr, function(year) as.numeric(stg6$year == year)) %>% bind_cols() %>% suppressMessages()
names(ans) <- paste('f', as.character(stgyr), sep = '')
stg6 <- cbind(stg6, ans)
# generate dq
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
#
n <- stgyr[length(stgyr)] -stgyr[1] + 1
ans <- lapply(n:1, function(i) as.integer(stg6$wsum == i)) %>% bind_cols() %>% suppressMessages()
# rename
entry_yr <- stgyr - min(stg6$year) + 1
names(ans) <- paste('d', entry_yr, sep = '')
stg6 <- cbind(stg6, ans)
# reg
ans <- lm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + f2014 + f2015 + f2016 + d4 + d5+ d6, data = stg6)
summary(ans)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2013 f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
stata('xtset id year
xtreg logy c.d4#c.f2014 c.d4#c.f2015 c.d4#c.f2016 ///
c.d5#c.f2015 c.d5#c.f2016 ///
c.d6#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
0.97/(0.97+0.19)
0.97^2/(0.97^2+0.19^2)
group_by(stg6, year) %>% summarise(mean(d4*f2014))
?plm
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
library(skimr)
skim(stg6)
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
skim(stg6)
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
stg6[1:7,]
stg6$f2014 <- as.integer(stg6$year == 2014)
stg6$f2015 <- as.integer(stg6$year == 2015)
stg6$f2016 <- as.integer(stg6$year == 2016)
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
stg6$d4 <- as.integer(stg6$wsum == 3)
stg6$d5 <- as.integer(stg6$wsum == 2)
stg6$d6 <- as.integer(stg6$wsum == 1)
plm::plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6) %>%
summary()
library(did)
?aggte
data(mpdta)
force(mpdta)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata)
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
usethis::use_data(stg6)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# generate fq
gen_fst(stg6, 'year', 2013:2016)
source("~/elements/RawE/27_MyRPackages/didWD/data-raw/reg.R", echo=TRUE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
# generate fq
stg6 <- gen_fst(stg6, 'year', 2013:2016)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr = 2013:2016)
View(stg6)
# 双因素回归
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
document()
document()
# ----------add X--------------
# 对X组内去均值
stg6$x1_dm4 <- stg6$x1 - mean(stg6$x1[stg6$d4==1])
stg6$x1_dm5 <- stg6$x1 - mean(stg6$x1[stg6$d5==1])
stg6$x1_dm6 <- stg6$x1 - mean(stg6$x1[stg6$d6==1])
stata('
logy c.w#c.d4#c.f2014 c.w#c.d4#c.f2015 c.w#c.d4#c.f2016 ///
c.w#c.d5#c.f2015 c.w#c.d5#c.f2016 ///
c.w#c.d6#c.f2016 ///
c.w#c.d4#c.f2014#c.x1_dm4 c.w#c.d4#c.f2015#c.x1_dm4 c.w#c.d4#c.f2016#c.x1_dm4 ///
c.w#c.d5#c.f2015#c.x1_dm5 c.w#c.d5#c.f2016#c.x1_dm5 ///
c.w#c.d6#c.f2016#c.x1_dm6 ///
f2014 f2015 f2016 c.f2014#c.x1 c.f2015#c.x1 c.f2016#c.x1, fe vce(cluster id)
')
stata('
xtset id year
xtreg logy c.w#c.d4#c.f2014 c.w#c.d4#c.f2015 c.w#c.d4#c.f2016 ///
c.w#c.d5#c.f2015 c.w#c.d5#c.f2016 ///
c.w#c.d6#c.f2016 ///
c.w#c.d4#c.f2014#c.x1_dm4 c.w#c.d4#c.f2015#c.x1_dm4 c.w#c.d4#c.f2016#c.x1_dm4 ///
c.w#c.d5#c.f2015#c.x1_dm5 c.w#c.d5#c.f2016#c.x1_dm5 ///
c.w#c.d6#c.f2016#c.x1_dm6 ///
f2014 f2015 f2016 c.f2014#c.x1 c.f2015#c.x1 c.f2016#c.x1, fe vce(cluster id)
', data.in = stg6)
plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
knitr::opts_chunk$set(echo = TRUE)
library(lmtest)
?coeftest
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2011 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
stg6$f2012 <- as.integer(stg6$year == 2012)
stg6$f2013 <- as.integer(stg6$year == 2013)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2011 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
library(car)
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ d4:f2012 + d4:f2013 +  d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
library(car)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
CTH0 <- c('d4:f2012', 'd4:f2013', 'd5:f2012', 'd5:f2013', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
summary(ans)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + f2012:d5 + f2013:d5 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'd6:f2012', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'd6:f2013', 'd6:f2014', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
ans <- plm(logy ~ f2012 + f2013 + f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
linearHypothesis(ans, CTH0)
CTH0 <- c('f2012:d4', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
CTH0 <- c('f2012:d4', 'f2013:d4', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm, RStata, devtools)
load_all()
# stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
# usethis::use_data(stg6)
# generate fq
stg6 <- gen_fst(stg6, 'year', 2013:2016)
# generate dq
stg6 <- gen_dq(stg6, id, w, stgyr = 2013:2016)
# 双因素回归
ans <- plm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
plm(logy ~ d2014:f2014 + d2014:f2015 + d2014:f2016 + d2015:f2015 + d2015:f2016 +
d2016:f2016 + d2014:f2014:x1_dm4 + d2014:f2015:x1_dm4 + d2014:f2016:x1_dm4 + d2015:f2015:x1_dm5 +
d2015:f2016:x1_dm5 + d2016:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6) %>% summary()
?coeftest
?vcovHC.plm
coeftest(ans, vcov. = vcovHC, method = 'white2')
# 单因素回归
stata('xtset id year
xtreg logy c.d2014#c.f2014 c.d2014#c.f2015 c.d2014#c.f2016 ///
c.d2015#c.f2015 c.d2015#c.f2016 ///
c.d2016#c.f2016 ///
f2014 f2015 f2016, fe vce(cluster id)', data.in = stg6)
coeftest(ans, vcov. = vcovHC, method = 'arellano')
coeftest(ans, vcov. = vcovHC, method = 'white2')
?vcovHC
linearHypothesis(ans, CTH0, vcov. = vcovHC)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
rm(list = ls())
library(pacman)
p_load(readstata13, tidyverse, plm)
# 这是我的本地存储，你可以下载数据后更换成你的存储位置
stg6 <- read.dta13('/Users/yangnay/elements/RawE/15_MySummary/异质性DID/Code/staggered_6.dta')
stg6[1:7,]
stg6$f2014 <- as.integer(stg6$year == 2014)
stg6$f2015 <- as.integer(stg6$year == 2015)
stg6$f2016 <- as.integer(stg6$year == 2016)
stg6 <- group_by(stg6, id) %>% summarise(wsum = sum(w)) %>% left_join(stg6,., by = 'id')
stg6$d4 <- as.integer(stg6$wsum == 3)
stg6$d5 <- as.integer(stg6$wsum == 2)
stg6$d6 <- as.integer(stg6$wsum == 1)
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
summary(ans)
library(lmtest)
coeftest(ans, vcov. = vcovHC, method = 'white2')
stg6$x1_dm4 <- stg6$x1 - mean(stg6$x1[stg6$d4==1])
stg6$x1_dm5 <- stg6$x1 - mean(stg6$x1[stg6$d5==1])
stg6$x1_dm6 <- stg6$x1 - mean(stg6$x1[stg6$d6==1])
ans <- plm(logy ~ d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
summary(ans)
coeftest(ans, vcov. = vcovHC, method = 'white2')
stg6$f2012 <- as.integer(stg6$year == 2012)
stg6$f2013 <- as.integer(stg6$year == 2013)
ans <- plm(logy ~ d4:f2012 + d4:f2013 + d5:f2012 + d5:f2013 + d5:f2014 + d6:f2012 +
d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016, index = c('id','year'), effect = 'twoways',model = 'within', data = stg6)
library(car)
CTH0 <- c('d4:f2012', 'd4:f2013', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0)
ans <- plm(logy ~ f2012:x1 + f2013:x1 + d4:f2012 + d4:f2013 + d5:f2012 +
d5:f2013 + d5:f2014 + d6:f2012 + d6:f2013 + d6:f2014 + d6:f2015 +
d4:f2014 + d4:f2015 + d4:f2016 + d5:f2015 + d5:f2016 +
d6:f2016 + d4:f2014:x1_dm4 + d4:f2015:x1_dm4 + d4:f2016:x1_dm4 + d5:f2015:x1_dm5 +
d5:f2016:x1_dm5 + d6:f2016:x1_dm6 + f2014:x1 + f2015:x1 + f2016:x1, index = c('id','year'), effect = 'twoways',
model = 'within', data = stg6)
CTH0 <- c('f2012:d4', 'f2013:d4', 'f2012:d5', 'f2013:d5', 'd5:f2014', 'f2012:d6', 'f2013:d6', 'f2014:d6', 'd6:f2015')
linearHypothesis(ans, CTH0, vcov. = vcovHC)
linearHypothesis(ans, CTH0, vcov. = vcovHC, method = 'white2)
linearHypothesis(ans, CTH0, vcov. = vcovHC, method = 'white2')
linearHypothesis(ans, CTH0)
